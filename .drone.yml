---
kind: pipeline
type: docker
name: build-images

steps:
- name: setup-cache
  image: drillster/drone-volume-cache
  settings:
    restore: true
    mount:
      - /mnt/drone-cache/gcc-cache
  volumes:
    - name: cache
      path: /cache
- name: build-ppc-amigaos-sdk-image
  image: plugins/docker
  settings:
    repo: walkero/amigagccondocker
    tags:
      - "ppc-amigaos-sdk"
    # cache_from:
    #   - walkero/amigagccondocker:ppc-amigaos-sdk
    dockerfile: sdk/Dockerfile
    purge: true
    build_args:
      - squash
    username:
      from_secret: DOCKERHUB_USERNAME
    password:
      from_secret: DOCKERHUB_PASSWORD
    storage_path: /mnt/drone-cache/gcc-cache
# - name: build-ppc-amigaos-gcc8-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-amigaos-gcc8"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-amigaos-gcc8
#     dockerfile: gcc/Dockerfile
#     purge: true
#     build_args:
#       - squash
#       - GCC_VER=8
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD
#   depends_on:
#     - build-ppc-amigaos-sdk-image
# - name: build-ppc-amigaos-gcc9-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-amigaos-gcc9"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-amigaos-gcc9
#     dockerfile: gcc/Dockerfile
#     purge: true
#     build_args:
#       - squash
#       - GCC_VER=9
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD
#   depends_on:
#     - build-ppc-amigaos-sdk-image
# - name: build-ppc-amigaos-gcc10-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-amigaos-gcc10"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-amigaos-gcc10
#     dockerfile: gcc/Dockerfile
#     purge: true
#     build_args:
#       - squash
#       - GCC_VER=10
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD
#   depends_on:
#     - build-ppc-amigaos-sdk-image
# - name: build-ppc-amigaos-gcc11-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-amigaos-gcc11"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-amigaos-gcc11
#     dockerfile: gcc/Dockerfile
#     purge: true
#     build_args:
#       - squash
#       - GCC_VER=11
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD
#   depends_on:
#     - build-ppc-amigaos-sdk-image

trigger:
  branch:
    include:
    - master
    - main
  event:
    include:
    - push

volumes:
  - name: cache
    host:
      path: /mnt/drone-cache

# ---
# kind: pipeline
# type: docker
# name: build-base-images

# steps:
# - name: build-gcc8-base-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-base-gcc8"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-base-gcc8
#     dockerfile: base/Dockerfile
#     build_args:
#       - GCC_VER=8
#       - MAKEFILES_PATH=base/files/native-build
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD
# - name: build-gcc9-base-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-base-gcc9"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-base-gcc9
#     dockerfile: base/Dockerfile
#     build_args:
#       - GCC_VER=9
#       - MAKEFILES_PATH=base/files/native-build
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD
# - name: build-gcc10-base-image
#   image: plugins/docker
#   settings:
#     repo: walkero/amigagccondocker
#     tags:
#       - "ppc-base-gcc10"
#     # cache_from:
#     #   - walkero/amigagccondocker:ppc-base-gcc10
#     dockerfile: base/Dockerfile
#     build_args:
#       - GCC_VER=10
#       - MAKEFILES_PATH=base/files/native-build
#     username:
#       from_secret: DOCKERHUB_USERNAME
#     password:
#       from_secret: DOCKERHUB_PASSWORD

# trigger:
#   branch:
#     include:
#     - base-images
#   event:
#     include:
#     - push
